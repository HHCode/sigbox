#!/bin/sh
# mount all the devices listed in /etc/fstab

/bin/mount -a

#/usr/etc/profile


#grep -q 'dnmode=multi' /proc/cmdline 2>/dev/null
#if [ "$?" = "0" ]; then
#        /bin/canna
#        exit 0
#fi

#grep -q 'dnmode=single' /proc/cmdline 2>/dev/null
#if [ "$?" = "0" ]; then
#        /bin/canna -s
#        exit 0
#fi

#grep -q 'resetmode=hard' /proc/cmdline 2>/dev/null


###################################################
# Symbolic Link Console dev
###################################################
grep -q 'TCC8900' /proc/cpuinfo 2>/dev/null
if [ "$?" = "0" ]; then
	TCC_ARCH="TCC8900"
	ln -s /dev/ttySAC1 /dev/ttySACX
#	ln -s /dev/ttySAC0 /dev/ttySACX
       
fi
grep -q 'AX' /proc/cpuinfo 2>/dev/null
if [ "$?" = "0" ]; then
	TCC_REV="AX"
fi
grep -q 'XX' /proc/cpuinfo 2>/dev/null
if [ "$?" = "0" ]; then
	TCC_REV="XX"
fi


###################################################
# NAND DRIVER
###################################################
## insmod NAND driver
insmod /lib/modules/TCC8900_nand.ko

## nand block queue scheduler --> noop
grep -q 'ndda' /proc/partitions 2>/dev/null
if [ "$?" = "0" ]; then
	echo noop > /sys/block/ndda/queue/scheduler
fi

## mount NAND partitions
grep -q 'ndda4' /proc/partitions 2>/dev/null
if [ "$?" = "0" ]; then
	mount -o utf8,noatime /dev/ndda4 /nand4
	echo "nand4 mounted"
fi
grep -q 'ndda3' /proc/partitions 2>/dev/null
if [ "$?" = "0" ]; then
	mount -o utf8,noatime /dev/ndda3 /nand3
	echo "nand3 mounted"
fi
grep -q 'ndda2' /proc/partitions 2>/dev/null
if [ "$?" = "0" ]; then
	mount -o utf8,noatime /dev/ndda2 /nand2
	echo "nand2 mounted"
fi
grep -q 'ndda1' /proc/partitions 2>/dev/null
if [ "$?" = "0" ]; then
	mount -o utf8,noatime /dev/ndda1 /nand1
	echo "nand1 mounted"
else
	mount -o utf8,noatime /dev/ndda /nand1
	echo "nand root mounted"
fi


###################################################
# USB OTG Compliance Test
###################################################
#### insmod USB File-backed Storage Gadget driver
#insmod /lib/modules/2.6.28/g_file_storage.ko file=/dev/ndda1

### printk level
#/usr/sbin/printk 3


###################################################
# ETHERNET DRIVER
###################################################
#if [ $TCC_ARCH = "TCC8900" ]; then
#	test -f /proc/net/wireless > /dev/null
#	if [ $? -eq 1 ]; then
#		insmod /lib/modules/2.6.28/dm9ks.ko
#	fi
#fi

###################################################
# HDMI DRIVER
###################################################
if [ $TCC_ARCH = "TCC8900" ]; then

	HDMI_USE=Y

	if [ $HDMI_USE = "Y" ]; then
	# insmod HDMI drivers
		insmod /lib/modules/hdmidrv.ko
		insmod /lib/modules/hpd.ko
	# DDC config
	#	ln -s /dev/i2c-1 /dev/i2c-ddc
		ln -s /dev/i2c-0 /dev/i2c-ddc
	fi
fi

###################################################
# HDMI DRIVER
###################################################
if [ $TCC_ARCH = "TCC8900" ]; then
	insmod /lib/modules/ufsd.ko
fi

###################################################
# FUSION DRIVER
###################################################
if [ $TCC_ARCH = "TCC8900" ]; then
	insmod /lib/modules/fusion.ko
fi


###################################################
# FOR SIGBOX
###################################################
mkdir /mnt/nfs
mount -t nfs -o nolock,tcp 192.168.1.100:/home/hawk/sigbox/sigbox/project/filesys/ /mnt/nfs

killall inetd
syslogd
ln -s /mnt/nfs/var/www /var/www
/mnt/nfs/usr/bin/thttpd -C /mnt/nfs/etc/thttpd.d/thttpd.conf &
cp /mnt/nfs/etc/passwd /etc

cp -a /mnt/nfs/usr/bin /usr
cp -a /mnt/nfs/etc/ /
